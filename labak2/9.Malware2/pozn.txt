Jerguš Lysy, 374217

MALWARE1

Po spustení malware1 wireshark zachytí niekoľko podozrivých adries. Jednou z týchto adries je 54.243.202.59. Malware sa pokúša naviazať spojenie s touto adresou a zároveň odosiela nejaké informácie na túto adresu (dotazom POST /rssnews.php HTTP/1.1). Táto adresa je DNS interpretovaná ako sovereutilizeignty.com.
Malware sa ďalej pokúša spojiť s adresou 192.241.149.43 - tá je interpretovaná ako benhomelandefit.com. Na tento server odosiela presné tú istú požiadavku ako pri predošlej adrese.

Pri zadaní doménoveho mena sovereutilizeignty.com do google môžem nájsť zaujímavé informácie, a to hneď na stránke http://www.symantec.com. Podľa symantec ide trojan Trojan.Stabuniq, ktorý komunikuje s nasledujúcimí servermi:

anatwriteromist.com
bbcnews192.com
belsaw920.com
benhomelandefit.com	(zachytené)
midfielderguin.com
prominentpirsa.com
sovereutilizeignty.com (zachytené)
yolanda911.com

Pred spustením tohto víru som uložil výpis z Autoruns. Tento výpis porovnám s výpisom po spustení viru a môžem vidieť, že do HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run a HKCMU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run pribudli záznami s hodnotou registra "c:\program files\7-zip\update\jqs.exe".
Tieto pridané záznamy zaručujú, aby sa trojan spustil pri každom spustení Windows.
Ak to porovnám s tým čo je udávane na symantec, tak správanie vírusu je v podstate tak ako je poísané:

%ProgramFiles%\[FOLDER NAME ONE]\[FOLDER NAME TWO]\jqs.exe

kde pre [FOLDER NAME ONE] bol použitý 7-zip (ukladá zrejme skôr tam, kde už niečo existuje), pre [FOLDER NAME TWO] bol použitý názov Update. meno súboru je práve jqs.exe.

Po opätovnom spúštaní je adresár 7-zip zachovaní a náhodne sa menia podadresár a meno súboru (v mojom prípade som dostal prakticky všetky možnosti až na groovemonitor.exe).

Ďalším podozrivým javom, ktorý si možno všimnúť v Task managéri sú dva procesy iexplore.exe, pričom žiadny prehliadač IE nie je otvorený.

Pri monitorovaní pomocu ProcMon môžem vidieť, že po spustení malware1.exe je spustení proces iexplore.exe (ten zrejme spúšťa injekovaný kód), ktorý prekopíruje pôvodny súbor na jedno z miest (v tomto prípade ako jqs.exe) a zmaže ho.

Podľa hĺbkovej analýzy na http://resources.infosecinstitute.com/stabuniq-in-depth/ si tento malware predpripraví pamäť, do ktorej nakopíruje všetky potrebné údaje (cesty, mená súborov, atď.) taktiež samotný kód, ktorý je neskôr spustený.
Typicky je to spúštané ako program -> OpenProcess -> GetProcAddress -> VirtualAllocEx -> WriteProcessMemory -> CreateRemoteThread -> proces
V tomto prípade je program malware1.exe a infikovaný proces je iexplore. WriteProcessMemory/CreateRemoteThread sú funkcie, ktoré sa postarajú o zapísanie a spustenie kódu v pamäti procesu. Nepodarilo sa mi však zistiť ako presne malware postupuje, tj. či si vytvorí infokovanú .dll, na ktorú potom zavolá s loadlibrary (z kernel32.dll) a tá následne načíta infokovanú .dll, alebo iné metódy (podľa všetkého malware spustí ixplore.exe v suspend mode a vnúti mu adresu so svojím kódom).

Malware má nastavený zámok (mutex) ako prevenciu proti opakovanom spúštaní. Taktiež, pri anaýze vo wiresharku som mohol vidieť, že reťazce, ktré sú posielané s POST sú v nečitatelnom tvare. V ProcMon môžem vidieť, že malware okrem iného načítava kryptografickú knižnicu a reťazce predtým ako odošle na server šifruje.

Podľa všetkého ide o jednoduchý malware a na odstránenie stačí iba zakázať opätovnému spúštaní po reštarte, tj. zmazať záznamy v registroch a samotný malware.

Prenášané údaje malwarom sú:
    Architecture type
    Computer name
    File name of the threat
    IP address
    Operating system version
    Operating system service pack version, if installed
    Running processes

Príklad toho čo je odoslané v rssnews.php (samotný reťazec):
id=JyQhOCY4Jjgn&varname=Y2VzZA==&comp=q0VT...
